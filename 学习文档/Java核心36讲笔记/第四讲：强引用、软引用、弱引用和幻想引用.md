## Java 核心技术36讲笔记--第四讲：强引用、软引用、弱引用和幻想引用
[TOC]

### 前言：
在Java 中，除了基本类型外，其它所有的都是所谓的引用类型，指向各种不同的对象，理解引用对于掌握Java 
生命周期和JVM内部对垃圾收集的影响。

### 一、 强引用
+ 强引用： 就是我们常见的普通对象引用，只要还有强引用指向一个对象，就表明对象还“活着”，GC不会回收这样的对象即使即将发生 OOM 错误。
+ GC 回收时机：当超过了引用变量的作用域或者显示地将变量置位null，则变量指向的对象就会被认为“死亡”，GC就可能会回收这个对象的内存，具体如何回收需要看GC的策略。

### 二、 软引用
+ 软引用： 软引用是相对强引用弱一点的引用。
+ GC 回收时机： 
	1. 像强引用一样，引用失效时。
	2. 即将发生OOM错误时，GC会优先将弱引用对象内存回收。

+ 使用场景： 通常可以用来实现内存敏感的缓存，如果还有空闲的内存可以保留内存，若内存不足就回收，
这样就保证了使用缓存的同时不会耗尽内存。

### 三、 弱引用
+ 弱引用： 比软引用还要再弱一点的引用。
+ GC 回收时机：GC执行时就会被回收。
+ 使用场景：
	1. 也可以用弱引用做缓存。
	2. 构建一种没有特定约束的关系，比如：非强制性的映射关系，如果试图获取时对象还在，就使用它，否则重新实例化。

### 四、 幻想引用
+ 幻想引用（虚引用）： 无法通过幻想引用访问对象。它仅仅是提供了一种确保对象被 finalize 以后，做某些事情的机制。
+ GC 回收时机： 幻想引用因为无法访问对象，所以也不存在被GC回收的情况。
+ 使用场景： 
	1. Cleaner 机制。
	2. 监控对象的创建和销毁。（如何实现呢？）

### 扩展
+ 对象可达性状态流转分析 
	+ 强可达： 存在线程不通过引用，直接访问到对象。
	+ 软可达： 必须通过软引用访问对象。
	+ 弱可达： 只能通过弱引用访问对象。
	+ 幻象可达： 没有强、软、弱引用关联，并被 finalize过，且还未被清除，只有幻象引用指向这个对象的时候。
	+ 不可达状态： 意味着对象可以被清除了。

<img src="https://static001.geekbang.org/resource/image/36/b0/36d3c7b158eda9421ef32463cb4d4fb0.png"/>
	
	所有引用类型，都是抽象类 java.lang.ref.Reference 的子类，其中有个 get()方法。
	除了幻象引用通过get()获取的是null，其它引用都可以通过这个方法获取到指向的对象，软、弱引用可以通过这方法，获取对象后，重新将它指向强引用。
	所以，GC 时都会对软、弱引用的对象进行二次确认，确认对象是否被改变为强引用。
	


